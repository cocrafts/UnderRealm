System.register("chunks:///_virtual/animation.ts",["cc"],(function(t){"use strict";var n;return{setters:[function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"07fc1gMvsRJn5e5KYLoXi+S","animation",void 0);t("playAnimation",(function(t,n,i){void 0===n&&(n="fade-in");var e=t.getComponent("cc.Animation");i&&(e.getState(n).duration=i);e.play(n)}));n._RF.pop()}}}));

System.register("chunks:///_virtual/attribute.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./helper.ts","./system.ts","./index.js"],(function(e){"use strict";var t,n,r,a,i,o,c;return{setters:[function(e){t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){r=e.cclegacy,a=e.Label},null,function(e){i=e.getPositiveColor},function(e){o=e.system},function(e){c=e.default}],execute:function(){r._RF.push({},"5d676dPc+hFdLWQ6zfYuqKi","attribute",void 0);var l=c.getCard,u=c.getCardState,d=c.getFacingIdentifier,s=c.getEnemyId,h=c.selectPlayer,g=c.selectGround,f=c.getComputedAttribute,p=(e("updateGroundUnits",(function(){o.duel.firstGround.forEach(p),o.duel.secondGround.forEach(p)})),e("updateUnit",function(){var e=t(n().mark((function e(t){var r,c,s,h,g,p,v,y,C,m,P,b,k,B,S,x,w,R,j,G,H,F,N,_,E,I,L,M,U;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=o.cardRefs[t]){e.next=3;break}return e.abrupt("return");case 3:if(h=l(o.duel.cardMap,t),g=h.attribute,p=u(o.duel.stateMap,t),v=f(o.duel,t),y=f(o.predict,t),C=d(o.duel,p.owner,p.id),m=s.getChildByPath("front/health"),P=m.getComponent(a),b=s.getChildByPath("front/defense"),k=b.getComponent(a),B=s.getChildByPath("front/attack"),S=B.getComponent(a),x=s.getChildByPath("front/charge/value").getComponent(a),w=s.getChildByPath("front/death"),R=s.getChildByPath("prediction/health"),j=R.getComponent(a),G=s.getChildByPath("prediction/defense"),H=G.getComponent(a),F=s.getChildByPath("prediction/attack"),N=F.getComponent(a),P.string=String(v.health),P.color=i(v.health,g.health),k.string=String(v.defense),k.color=i(v.defense,g.defense),S.string=String(v.attack),S.color=i(v.attack,g.attack),void 0!==v.charge&&(x.string=String(v.charge)),G.active=!1,G.active=!1,R.active=!1,G.active=!1,F.active=!1,w.active=!1,_=o.cardRefs[null==C?void 0:C.id],E=null==(r=s.getChildByPath("back"))?void 0:r.active,I=null==_||null==(c=_.getChildByPath("back"))?void 0:c.active,_&&!E&&!I){e.next=41;break}return e.abrupt("return");case 41:L=y.health-v.health,M=y.defense-v.defense,U=y.attack-v.attack,y.health<=0&&(w.active=!0),0===L?R.active=!1:(R.active=!0,j.string=String(L),j.color=i(L)),0===M?G.active=!1:(G.active=!0,H.string=String(M),H.color=i(M)),0===U?F.active=!1:(F.active=!0,N.string=String(U),N.color=i(U));case 48:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),v=(e("updatePlayers",function(){var e=t(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[v(o.duel.firstPlayer.id),v(o.duel.secondPlayer.id)],e.next=3,Promise.all(t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),e("updatePlayer",function(){var e=t(n().mark((function e(t){var r,i,c,l,u,d,p,v,y,C,m,P,b,k,B;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=h(o.duel,t),i=s(o.duel,t),c=g(o.duel,t),l=g(o.duel,i),u=r.id===o.playerIds.me,d=u?o.globalNodes.playerHealth:o.globalNodes.enemyHealth,p=u?o.globalNodes.playerHealthPredict:o.globalNodes.enemyHealthPredict,v=d.getComponent(a),y=p.getComponent(a),C=0,m=0;m<l.length;m+=1)b=l[m]&&!c[m],k=o.cardRefs[l[m]],!b||null!=k&&null!=(P=k.getChildByPath("back"))&&P.active||(B=f(o.duel,l[m]),C-=B.attack);v.string=String(r.health),y.string=String(C),p.active=0!==C;case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));r._RF.pop()}}}));

System.register("chunks:///_virtual/BoardManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./layout.ts","./resources.ts","./system.ts","./index.ts","./index3.ts","./index.js","./sender.ts","./card.ts","./common.ts"],(function(e){"use strict";var t,n,a,o,d,i,s,l,r,u,h,c,y;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,a=e._decorator,o=e.Label,d=e.Component},null,function(e){i=e.getPositionExpos},function(e){s=e.switchBackgroundSound},function(e){l=e.system},null,null,function(e){r=e.default},function(e){u=e.sendConnect},function(e){h=e.animateGlowOn,c=e.animateGlowOff},function(e){y=e.simpleMove}],execute:function(){var p;n._RF.push({},"5e9daqPUfNBGZ6nn1SQvftq","BoardManager",void 0);var g=a.ccclass,b=r.CardType,m=r.DuelPlace,f=r.DuelPhases,P=r.selectStateKey,C=r.selectPlayer,H=r.selectHand,B=r.getCard,N=r.version,G=(e("BoardManager",g("BoardManager")(p=function(e){function n(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).unSubscribers=[],t.playerDeckCount=void 0,t.enemyDeckCount=void 0,t.props={},t}t(n,e);var a=n.prototype;return a.start=function(){var e=this.node.getChildByPath("Air/fog"),t=this.node.getChildByPath("Card Template"),n=this.node.getChildByPath("Unit Template"),a=this.node.getChildByPath("Surface/Unit Preview"),d=this.node.getChildByPath("Surface/Player Deck/foil"),i=this.node.getChildByPath("Surface/Enemy Deck/foil"),s=this.node.getChildByPath("Guide/centerExpo"),r=this.node.getChildByPath("Guide/leftExpo"),h=this.node.getChildByPath("Guide/rightExpo"),c=this.node.getChildByPath("playerHand"),y=this.node.getChildByPath("Surface/enemyHand"),p=this.node.getChildByPath("Surface/playerGround"),g=this.node.getChildByPath("Surface/enemyGround"),b=this.node.getChildByPath("Guide/playerHand"),m=this.node.getChildByPath("Guide/playerGround"),f=this.node.getChildByPath("Guide/enemyHand"),P=this.node.getChildByPath("Guide/enemyGround"),C=this.node.getChildByPath("Guide/summonZone"),H=this.node.getChildByPath("Hud/version"),B=this.node.getChildByPath("Hud/playerHealth"),G=this.node.getChildByPath("Hud/playerHealthPredict"),S=this.node.getChildByPath("Hud/enemyHealth"),v=this.node.getChildByPath("Hud/enemyHealthPredict");this.playerDeckCount=this.node.getChildByPath("Surface/playerDeckCount").getComponent(o),this.enemyDeckCount=this.node.getChildByPath("Surface/enemyDeckCount").getComponent(o),H.getComponent(o).string="version "+N,l.globalNodes.board=this.node,l.globalNodes.fog=e,l.globalNodes.cardTemplate=t,l.globalNodes.unitTemplate=n,l.globalNodes.unitPreview=a,l.globalNodes.playerDeck=d,l.globalNodes.enemyDeck=i,l.globalNodes.centerExpo=s,l.globalNodes.leftExpo=r,l.globalNodes.rightExpo=h,l.globalNodes.playerHand=c,l.globalNodes.enemyHand=y,l.globalNodes.playerGround=p,l.globalNodes.enemyGround=g,l.globalNodes.playerHandGuide=b,l.globalNodes.playerGroundGuide=m,l.globalNodes.enemyHandGuide=f,l.globalNodes.enemyGroundGuide=P,l.globalNodes.summonZoneGuide=C,l.globalNodes.playerHealth=B,l.globalNodes.playerHealthPredict=G,l.globalNodes.enemyHealth=S,l.globalNodes.enemyHealthPredict=v,l.globalNodes.board.on("stateReady",this.onStateReady.bind(this)),l.context&&this.onStateReady(),u()},a.onDestroy=function(){this.unSubscribers.forEach((function(e){return e()}))},a.onStateReady=function(){this.unSubscribers.push(l.duel.subscribe(P(l.duel,l.playerIds.me,m.Player),this.onPlayerUpdate.bind(this),!0)),this.unSubscribers.push(l.duel.subscribe(P(l.duel,l.playerIds.me,m.Deck),this.onPlayerDeckUpdate.bind(this),!0)),this.unSubscribers.push(l.duel.subscribe(P(l.duel,l.playerIds.enemy,m.Deck),this.onEnemyDeckUpdate.bind(this),!0)),this.unSubscribers.push(l.duel.subscribe(P(l.duel,l.playerIds.me,m.Hand),this.onPlayerHandUpdate.bind(this))),this.unSubscribers.push(l.duel.subscribe(P(l.duel,l.playerIds.enemy,m.Hand),this.onEnemyHandUpdate.bind(this))),this.unSubscribers.push(l.duel.subscribe("phase",this.onPhaseUpdate.bind(this)))},a.onPlayerUpdate=function(e,t){var n=this;e.perTurnHero!==(null==t?void 0:t.perTurnHero)&&setTimeout((function(){return n.updateInteractions()}),0),(null==t?void 0:t.health)>G&&e.health<G&&s("bgm-dungeon-peak",.2)},a.onPlayerDeckUpdate=function(e){this.playerDeckCount.string=String(e.length)},a.onEnemyDeckUpdate=function(e){this.enemyDeckCount.string=String(e.length)},a.onPlayerHandUpdate=function(e){this.reArrangeHand(l.playerIds.me,e)},a.onEnemyHandUpdate=function(e){this.reArrangeHand(l.playerIds.enemy,e)},a.onPhaseUpdate=function(){var e=this;setTimeout((function(){return e.updateInteractions()}),0)},a.updateInteractions=function(){var e=C(l.duel,l.playerIds.me),t=l.duel.phaseOf===l.playerIds.me,n=l.duel.phase===f.Setup,a=t&&n,o=a&&e.perTurnHero>0,d=H(l.duel,l.playerIds.me);l.isCommandAble=a,d.forEach((function(e){var t=B(l.duel.cardMap,e),n=l.cardRefs[e],a=t.kind===b.Hero,d=t.kind===b.Troop;n&&(d?l.isCommandAble?h(n):c(n):a&&(o?h(n):c(n)))}))},a.reArrangeHand=function(e,t){for(var n=l.playerIds.me===e?i(l.globalNodes.playerHandGuide,t.length,80):i(l.globalNodes.enemyHandGuide,t.length,60),a=0;a<t.length;a+=1){var o=l.cardRefs[t[a]];o&&y(o,n[a])}},n}(d))||p),150);n._RF.pop()}}}));

System.register("chunks:///_virtual/card.ts",["cc","./resources.ts"],(function(e){"use strict";var t,n,o,a,i,r;return{setters:[function(e){t=e.cclegacy,n=e.Vec3,o=e.Quat,a=e.tween,i=e.UIOpacity},function(e){r=e.playEffectSound}],execute:function(){t._RF.push({},"2f0a9Qfu0pMZbbRkYU6OxCF","card",void 0);var s=new n(440,-15,0),c=new n(425,-232,0),u=e("animateExpoCard",(function(e){var t=e.node,i=e.from,u=void 0===i?c:i,l=e.dest,d=void 0===l?s:l,f=e.delay,p=void 0===f?0:f,w=e.speed,v=void 0===w?1:w,g=!1,m=new n(d.x,d.y-25,d.z),y=o.fromEuler(new o,90,90,91),O=o.fromEuler(new o,12,0,0),x=o.fromEuler(new o,0,0,0),E=a(t).set({position:u}).to(.5/v,{position:m},{easing:"cubicIn"}).to(1.5/v,{position:d},{easing:"backIn"}),b=a(t).set({rotation:y,active:!0}).to(.5/v,{rotation:O},{easing:"cubicIn",onUpdate:function(e){if(!g){var t=new n(0,0,0);e.rotation.getEulerAngles(t),t.z<30&&(r("card-flip",.3),e.getChildByPath("back").active=!1,g=!0)}}}).to(1.5/v,{rotation:x},{easing:"quadIn"}),h=a(t).set({scale:new n(.18,.18,1)}).to(.5/v,{scale:new n(.48,.48,1)},{easing:"quadIn"}).to(1/v,{scale:new n(.5,.5,1)},{easing:"quadOut"});return a(t).delay(p).parallel(E,b,h)})),l=new n(0,-360,0);e("animateDrawPlayerCard",(function(e){var t=e.node,o=e.from,a=void 0===o?c:o,i=e.expoDest,d=void 0===i?s:i,f=e.dest,p=void 0===f?l:f,w=e.delay,v=void 0===w?0:w,g=e.speed,m=void 0===g?1:g;return new Promise((function(e){u({node:t,from:a,dest:d,delay:v,speed:m}).to(.8,{position:p,scale:new n(.4,.4,1)},{easing:"expoOut"}).call((function(){r("light-fire",.3),e()})).start()}))})),e("animateDrawEnemyCard",(function(e){var t=e.node,i=e.from,s=e.dest,c=e.delay,u=void 0===c?0:c;return new Promise((function(e){var c=o.fromEuler(new o,0,0,90),l=o.fromEuler(new o,0,0,180);a(t).delay(u).call((function(){return r("card-flip",.3)})).set({position:i,rotation:c,scale:new n(.18,.18,1)}).to(1,{position:s,rotation:l,scale:new n(.28,.28,1)},{easing:"expoInOut"}).call((function(){return e()})).start()}))})),e("animateGlowOn",(function(e){var t=e.getChildByPath("glow");t.active=!0,a(t.getComponent(i)).set({opacity:0}).to(3,{opacity:150},{easing:"expoOut"}).start()})),e("animateGlowOff",(function(e){var t=e.getChildByPath("glow");a(t.getComponent(i)).to(1,{opacity:0},{easing:"expoOut"}).call((function(){return t.active=!1})).start()})),e("animateGroundReveal",(function(e,t){return void 0===t&&(t=50),new Promise((function(i){var r=!1,s=o.fromEuler(new o,180,0,0),c=o.fromEuler(new o,0,0,0),u=a(e).by(.25,{position:new n(0,t,0)},{easing:"backOut"}).by(.75,{position:new n(0,-t,0)},{easing:"expoOut"}),l=a(e).to(.25,{scale:new n(.25,.25,1)}).to(.75,{scale:new n(.24,.24,1)},{easing:"backOut"}),d=a(e).set({rotation:s}).to(1,{rotation:c},{easing:"expoOut",onUpdate:function(e){if(!r){var t=new n(0,0,0);e.rotation.getEulerAngles(t),t.x<90&&(e.getChildByPath("back").active=!1,r=!0)}}}).call(i).start();a(e).parallel(u,l,d).call(i).start()}))}));t._RF.pop()}}}));

System.register("chunks:///_virtual/CardManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./animation.ts","./helper.ts","./system.ts","./index.js"],(function(t){"use strict";var i,e,a,n,s,o,r,d,c,l,h,u,g,f,C,v,p,m,b;return{setters:[function(t){i=t.inheritsLoose,e=t.extends},function(t){a=t.cclegacy,n=t._decorator,s=t.Animation,o=t.UIOpacity,r=t.Label,d=t.RichText,c=t.Sprite,l=t.resources,h=t.Component},null,function(t){u=t.playAnimation},function(t){g=t.getSkillDesc,f=t.getVisualUri,C=t.getFoilUri,v=t.getClassUri,p=t.setCursor},function(t){m=t.system},function(t){b=t.default}],execute:function(){var y;a._RF.push({},"cae62yZ7hdE5aT7BjgC31RY","CardManager",void 0);var P=n.ccclass,k=b.getCard;t("CardManager",P("CardManager")(y=function(t){function a(){for(var i,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(i=t.call.apply(t,[this].concat(a))||this).unsubscribe=void 0,i.isMouseInside=!1,i.cardId=void 0,i.animation=void 0,i.uiOpacity=void 0,i.cardFront=void 0,i.cardName=void 0,i.cardHealth=void 0,i.cardDefense=void 0,i.cardAttack=void 0,i.cardSkill=void 0,i.cardFoil=void 0,i.cardVisual=void 0,i.cardClass=void 0,i}i(a,t);var n=a.prototype;return n.start=function(){this.cardFront=this.node.getChildByPath("front"),this.animation=this.node.getComponent(s),this.uiOpacity=this.node.getComponent(o),this.cardName=this.node.getChildByPath("front/name").getComponent(r),this.cardAttack=this.node.getChildByPath("front/attack").getComponent(r),this.cardDefense=this.node.getChildByPath("front/defense").getComponent(r),this.cardHealth=this.node.getChildByPath("front/health").getComponent(r),this.cardSkill=this.node.getChildByPath("front/skill").getComponent(d),this.cardFoil=this.node.getChildByPath("front/foil").getComponent(c),this.cardVisual=this.node.getChildByPath("front/visual").getComponent(c),this.cardClass=this.node.getChildByPath("front/class").getComponent(c),this.cardId&&this.subscribeCardChange()},n.onDestroy=function(){var t;null==(t=this.unsubscribe)||t.call(this)},n.setCardId=function(t){var i=this;t!==this.cardId&&(this.cardId=t,t.indexOf("#")>0?this.cardFront&&this.subscribeCardChange():setTimeout((function(){var a=k(m.duel.cardMap,t);i.onStateChange(e({id:t},a.attribute),null)}),200))},n.subscribeCardChange=function(){var t;null==(t=this.unsubscribe)||t.call(this),this.unsubscribe=m.duel.subscribe("state#"+this.cardId,this.onStateChange.bind(this),!0)},n.onStateChange=function(t,i){var e=this,a=k(m.duel.cardMap,t.id),n=t.id.substring(0,9)!==this.cardId.substring(0,9);if(!i){var s=a.title?" - "+a.title:"";this.cardName.string=""+a.name+s,this.cardSkill.string=g(a.skill.template)}if(t.health!==(null==i?void 0:i.health)&&(this.cardHealth.string=String(t.health)),t.defense!==(null==i?void 0:i.defense)&&(this.cardDefense.string=String(t.defense)),t.attack!==(null==i?void 0:i.attack)&&(this.cardAttack.string=String(t.attack)),!i||n){var o=f(a.id),r=C(a.id),d=v(a.class);l.load(o,(function(t,i){t||(e.cardVisual.spriteFrame=i)})),l.load(r,(function(t,i){t||(e.cardFoil.spriteFrame=i)})),l.load(d,(function(t,i){t||(e.cardClass.spriteFrame=i)}))}},n.showPreview=function(){u(m.globalNodes.cardPreview,"fade-in"),m.globalNodes.cardPreview.setPosition(0,-168)},n.hidePreview=function(){m.globalNodes.cardPreview.setPosition(190,740)},n.onMouseEnter=function(){p("grab"),m.dragging||(this.uiOpacity.opacity=50,m.previewing=!0,m.activeCard=this.node,m.globalNodes.cardPreview.setPosition(this.node.position.x,-168),u(m.globalNodes.cardPreview,"fade-in"))},n.onMouseLeave=function(){p("auto"),this.uiOpacity.opacity=255},a}(h))||y);a._RF.pop()}}}));

System.register("chunks:///_virtual/command.ts",["cc","./index.mjs_cjs=&original=.js","./index.js"],(function(e){"use strict";var o,r;return{setters:[function(e){o=e.cclegacy},null,function(e){r=e.default}],execute:function(){e("GroundMoves",void 0),o._RF.push({},"7b3e2BLx9ROUb6NVt3usz5r","command",void 0);var n,t=r.DuelCommandType,u=r.DuelPlace;!function(e){e[e.No=0]="No",e[e.Removal=1]="Removal",e[e.Relocate=2]="Relocate",e[e.GenerateFromAir=3]="GenerateFromAir"}(n||(n=e("GroundMoves",{})));var l=[u.Player,u.Ability];e("extractGroundMove",(function(e){if(e.type!==t.CardMove)return n.No;var o=e.target,r=o.from,a=o.to,c=(null==r?void 0:r.place)===u.Ground,i=(null==a?void 0:a.place)===u.Ground,d=(null==r?void 0:r.place)===u.Deck,s=(null==r||r.place,u.Grave,l.indexOf(r.place)>=0);if(c&&i)return n.Relocate;if(i){if(s)return n.GenerateFromAir;if(!d)return n.GenerateFromAir;console.log("Card from Deck to Ground not supported yet!")}else{if(c)return n.Removal;console.log("Generic move not (between non-ground) supported yet!")}return n.No}));o._RF.pop()}}}));

System.register("chunks:///_virtual/common.ts",["./rollupPluginModLoBabelHelpers.js","cc","./system.ts"],(function(t){"use strict";var n,e,r,o,a,i,u,c;return{setters:[function(t){n=t.asyncToGenerator,e=t.regeneratorRuntime},function(t){r=t.cclegacy,o=t.tween,a=t.Vec3,i=t.UIOpacity,u=t.Label},function(t){c=t.system}],execute:function(){r._RF.push({},"8872dOQxTdHub5g5T5Ohx4V","common",void 0);t("simpleMove",function(){var t=n(e().mark((function t(n,r,a){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===a&&(a=.2),t.abrupt("return",new Promise((function(t){o(n).to(a,{position:r},{easing:"expoInOut"}).call((function(){return t()})).start()})));case 2:case"end":return t.stop()}}),t)})));return function(n,e,r){return t.apply(this,arguments)}}()),t("animateFade",function(){var t=n(e().mark((function t(n,r,a){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===a&&(a=2),t.abrupt("return",new Promise((function(t){o(n.getComponent(i)).to(a,{opacity:r},{easing:"fade"}).call((function(){return t()})).start()})));case 2:case"end":return t.stop()}}),t)})));return function(n,e,r){return t.apply(this,arguments)}}()),t("animateSwapLabel",function(){var t=n(e().mark((function t(n,r,a,c){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===c&&(c=1),t.abrupt("return",new Promise((function(t){o(n.getComponent(i)).to(c/2,{opacity:0},{easing:"fade",onComplete:function(){var t=n.getComponent(u);t.string=r,t.color=a}}).to(c/2,{opacity:255},{easing:"expoInOut"}).call((function(){return t()})).start()})));case 2:case"end":return t.stop()}}),t)})));return function(n,e,r,o){return t.apply(this,arguments)}}()),t("shakeGround",(function(t,n){void 0===t&&(t=5),void 0===n&&(n=5);for(var e=o(c.globalNodes.board.getChildByPath("Surface")),r=0;r<n;r+=1){var i=Math.random()*t,u=Math.random()*t;e.to(0,{position:new a(i,u,0)}).delay(.08)}e.to(.5,{position:new a(0,0,0)}).start()})),t("animateSkillReady",(function(t){o(t).by(1,{position:new a(0,20,0)},{easing:"expoOut"}).by(1,{position:new a(0,-20,0)},{easing:"expoOut"}).repeatForever().start()}));r._RF.pop()}}}));

System.register("chunks:///_virtual/draw.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./CardManager.ts","./index3.ts","./helper.ts","./layout.ts","./system.ts","./index.js","./card.ts"],(function(e){"use strict";var n,t,a,r,s,o,l,d,i,u,c,p,g;return{setters:[function(e){n=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){a=e.cclegacy,r=e.instantiate},null,function(e){s=e.CardManager},null,function(e){o=e.selectDeckNode},function(e){l=e.getPositionExpos,d=e.getCenterExpos,i=e.getRightExpos},function(e){u=e.system},function(e){c=e.default},function(e){p=e.animateDrawPlayerCard,g=e.animateDrawEnemyCard}],execute:function(){a._RF.push({},"10052xP8+NAn7svrXkPdWcj","draw",void 0);var f=c.selectHand;e("playDraw",function(){var e=n(t().mark((function e(n){var a,c,m,y,h,x,v,w,C,N,P,b,j,H,D;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=n.phaseOf,c=n.commands,m=[],y=f(u.duel,a),h=o(a).parent.getPosition(),x=u.playerIds.me===a,v=x?l(u.globalNodes.playerHandGuide,y.length,80):l(u.globalNodes.enemyHandGuide,y.length,60),w=c.length>3?d:i,C=w(c.length),N=0;N<c.length;N+=1)P=y.length-c.length+N,b=y[P],j=v[P],H=C[N],(D=r(u.globalNodes.cardTemplate)).getComponent(s).setCardId(b),u.cardRefs[b]=D,a===u.playerIds.me?(D.parent=u.globalNodes.playerHand,m.push(p({node:D,from:h,dest:j,expoDest:H,delay:.2*N}))):(D.parent=u.globalNodes.enemyHand,m.push(g({node:D,from:h,dest:j,delay:.2*N})));return e.next=11,Promise.all(m);case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());a._RF.pop()}}}));

System.register("chunks:///_virtual/DuelManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./helper.ts","./layout.ts","./resources.ts","./system.ts","./CardManager.ts","./index.ts","./index3.ts","./UnitManager.ts","./index.js","./common.ts","./sender.ts","./preview.ts"],(function(e){"use strict";var i,t,n,o,a,r,d,s,l,u,g,c,v,h,p,C,f,y,P,m,w,b;return{setters:[function(e){i=e.inheritsLoose},function(e){t=e.cclegacy,n=e._decorator,o=e.Node,a=e.AudioSource,r=e.UIOpacity,d=e.Component},null,function(e){s=e.cardIdFromNode,l=e.getMyGround},function(e){u=e.getGroundExpos,g=e.getHandExpos},function(e){c=e.playBackgroundSound,v=e.playEffectSound},function(e){h=e.system},function(e){p=e.CardManager},null,null,function(e){C=e.UnitManager},function(e){f=e.default},function(e){y=e.simpleMove},function(e){P=e.sendCardSummon,m=e.sendCardHover},function(e){w=e.raiseHandCard,b=e.raiseHandPreview}],execute:function(){var M;t._RF.push({},"54ceeKg//pLKpoLmM5uGH72","DuelManager",void 0);var L=n.ccclass,N=f.selectHand,x=f.selectGround,I=f.getFirstEmptyLeft,U=f.getFirstEmptyRight,R=o.EventType;e("DuelManager",L("DuelManager")(M=function(e){function t(){for(var i,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(i=e.call.apply(e,[this].concat(n))||this).previewingLeft=!1,i.previewingRight=!1,i}i(t,e);var n=t.prototype;return n.start=function(){var e;h.audioSource=this.node.getComponent(a),h.globalNodes.duel=this.node,h.globalNodes.cardPreview=this.node.getChildByPath("Card Preview"),h.globalNodes.turnRibbon=this.node.getChildByPath("turnRibbon"),h.globalNodes.duelRibbon=this.node.getChildByPath("duelRibbon"),this.node.on(R.MOUSE_UP,this.onMouseUp.bind(this)),this.node.on(R.MOUSE_MOVE,this.onMouseMove.bind(this)),null==(e=document)||e.getElementById("GameCanvas").addEventListener("mouseout",this.onMouseOut.bind(this)),c("bgm-dungeon-crawl",.3)},n.onUnitPreview=function(){var e=h.globalNodes.unitPreview,i=u(h.globalNodes.playerGroundGuide);if(e.getComponent(C).setCardId(s(h.activeCard)),this.previewingLeft){var t=x(h.duel,h.playerIds.me),n=I(t);e.setPosition(i[n])}else if(this.previewingRight){var o=x(h.duel,h.playerIds.me),a=U(o);e.setPosition(i[a])}else e.setPosition(120,680)},n.onCardDrag=function(e){var i,t=e.getUILocation(),n=t.x,o=t.y,a=h.globalNodes.summonZoneGuide.getWorldPosition();null==(i=h.activeCard)||i.setWorldPosition(n,o,0),o>a.y?n>a.x&&!this.previewingRight?(this.previewingLeft=!1,this.previewingRight=!0,this.onUnitPreview()):n<a.x&&!this.previewingLeft&&(this.previewingLeft=!0,this.previewingRight=!1,this.onUnitPreview()):(this.previewingLeft=!1,this.previewingRight=!1,this.onUnitPreview())},n.onCardDrop=function(e){var i=e.getUILocation(),t=i.x,n=i.y,o=h.globalNodes.summonZoneGuide.getWorldPosition(),a=s(h.activeCard),r=N(h.duel,h.playerIds.me),d=r.indexOf(a),u=g(h.globalNodes.playerHandGuide,r.length);n<o.y?y(h.activeCard,u[d]):t>o.x?P(a,U(l())):P(a,I(l())),h.globalNodes.unitPreview.setPosition(120,680)},n.onMouseUp=function(e){h.dragging&&this.onCardDrop(e),h.dragging=!1,h.activeCard=null},n.onMouseMove=function(e){if(!h.winner&&0!==h.duel.firstMover.length)if(h.dragging&&h.activeCard)this.onCardDrag(e);else if(h.duel&&h.playerIds){var i,t,n=N(h.duel,h.playerIds.me),o=h.globalNodes.playerHandGuide.getWorldPosition(),a=e.getUILocation();if(a.y<o.y+106)for(var r=0;r<n.length;r+=1){var d=n[r],s=h.cardRefs[d];if(s){var l=s.getWorldPosition();if(l.y<o.y+10){var u,g=Math.abs(a.x-l.x);g<((null==(u=i)?void 0:u.distance)||70)&&(i={node:s,cardId:d,distance:g})}}}if(i)i.node.uuid!==(null==(t=h.activeCard)?void 0:t.uuid)&&(h.activeCard&&this.onCardLeave(h.activeCard),this.onCardHover(i.node,i.cardId),h.activeCard=i.node);else h.activeCard&&(this.onCardLeave(h.activeCard),h.activeCard=null)}},n.onMouseOut=function(){var e;h.dragging?null==(e=h.activeCard)||e.setPosition(9999,9999,0):h.activeCard&&(this.onCardLeave(h.activeCard),h.activeCard=null)},n.onCardHover=function(e,i){var t=e.getChildByPath("glow").active,n=h.globalNodes.cardPreview.getChildByPath("Card/glow"),o=h.globalNodes.cardPreview.getChildByPath("Card");n.active=t,o.getComponent(p).setCardId(i.substring(0,9)),h.globalNodes.cardPreview.setPosition(e.position.x,-180),v("hand-slide",.2),w(e,100),b(h.globalNodes.cardPreview),m(i,!0),e.getComponent(r).opacity=20},n.onCardLeave=function(e){h.globalNodes.cardPreview.setPosition(190,740),w(e,0),m(s(e),!1),e.getComponent(r).opacity=255},t}(d))||M);t._RF.pop()}}}));

System.register("chunks:///_virtual/DuelRibbonController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./helper.ts"],(function(o){"use strict";var t,n,e,i,r,s,u,l;return{setters:[function(o){t=o.inheritsLoose},function(o){n=o.cclegacy,e=o._decorator,i=o.Node,r=o.Button,s=o.sys,u=o.Component},function(o){l=o.setCursor}],execute:function(){var c;n._RF.push({},"4ec72iramJAqoMTYy+w8y4/","DuelRibbonController",void 0);var b=e.ccclass,a=i.EventType,h=r.EventType;o("DuelRibbonController",b("DuelRibbonController")(c=function(o){function n(){for(var t,n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return(t=o.call.apply(o,[this].concat(e))||this).lobbyButton=void 0,t}t(n,o);var e=n.prototype;return e.start=function(){this.lobbyButton=this.node.getChildByPath("Button"),this.lobbyButton.on(a.MOUSE_ENTER,this.onMouseEnter.bind(this)),this.lobbyButton.on(a.MOUSE_LEAVE,this.onMouseLeave.bind(this)),this.lobbyButton.on(h.CLICK,this.onLobbyClick.bind(this))},e.onMouseEnter=function(){l("pointer")},e.onMouseLeave=function(){l("auto")},e.onLobbyClick=function(){s.isBrowser&&(location.href=location.origin+"/game")},n}(u))||c);n._RF.pop()}}}));

System.register("chunks:///_virtual/fight.ts",["./rollupPluginModLoBabelHelpers.js","cc","./attribute.ts","./resources.ts","./system.ts","./common.ts"],(function(t){"use strict";var e,n,a,r,o,i,s,u,c,f,l,p,g;return{setters:[function(t){e=t.asyncToGenerator,n=t.regeneratorRuntime},function(t){a=t.cclegacy,r=t.Quat,o=t.tween,i=t.Vec3,s=t.Animation},function(t){u=t.updateUnit,c=t.updatePlayers},function(t){f=t.playEffectSound,l=t.instantiatePrefab},function(t){p=t.system},function(t){g=t.shakeGround}],execute:function(){a._RF.push({},"7c876GrwtFIDb3aU7CgrDTv","fight",void 0);t("animateCardAttack",function(){var t=e(n().mark((function t(e,a,y){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=p.cardRefs[e];if(!n)return t();var d=!1,h=n.getPosition(),m=n.getChildByPath("back"),v=h.y<0?-12:12,w=r.fromEuler(new r,0,180,0),b=r.fromEuler(new r,0,0,0),x=o(n).to(1,{position:new i(h.x,h.y+v,0)},{easing:"backOut"}).to(.2,{position:new i(h.x,0,0)},{easing:"expoOut"}).call((function(){u(e),0===y&&(f("attack",1),g(10,5),c()),l("prefabs/HitEffect").then((function(t){t.parent=n,t.setScale(new i(5,5,1));var e=t.getComponent(s);e.play("flip"),e.on(s.EventType.FINISHED,(function(){t.destroy()}))}))})).to(.5,{position:h},{easing:"expoOut"}),k=null!=m&&m.active?o(n).set({rotation:w}).to(1,{rotation:b},{easing:"expoOut",onUpdate:function(t){if(!d){var e=new i(0,0,0);t.rotation.getEulerAngles(e),e.y<90&&(t.getChildByPath("front").active=!0,m.active=!1,d=!0)}}}):o(n).delay(1);if(a){var P=1280*Math.random()-640;n.parent=p.globalNodes.playerHand,x.to(.5,{position:new i(P,h.y>0?600:-600,0),scale:new i(.6,.6,1)},{easing:"expoIn"}).call((function(){f("death",.5),n.destroy()}))}else x.to(.5,{position:h},{easing:"backOut"});o(n).parallel(x,k).call(t).start()})));case 1:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()),t("animateRelocate",function(){var t=e(n().mark((function t(e,a){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){o(e).to(.2,{position:a},{easing:"expoOut"}).call((function(){f("light-fire",.5),t()})).start()})));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());a._RF.pop()}}}));

System.register("chunks:///_virtual/fight2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./lodash.mjs_cjs=&original=.js","./index3.ts","./command.ts","./index.js","./lodash.js","./fight.ts"],(function(n){"use strict";var t,r,e,u,i,o,a,c;return{setters:[function(n){t=n.asyncToGenerator,r=n.regeneratorRuntime},function(n){e=n.cclegacy},null,null,null,function(n){u=n.extractGroundMove,i=n.GroundMoves},function(n){o=n.default},function(n){a=n.default},function(n){c=n.animateCardAttack}],execute:function(){e._RF.push({},"fa55fn2f+RFULVjtFwKBYkV","fight",void 0);var s=o.CommandSourceType,l=(n("playFight",function(){var n=t(r().mark((function n(t){var e,u,i,o;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=t.commands,u=[],i=e.filter(l),o=e.filter(f).map((function(n){var t;return null==(t=n.target.from)?void 0:t.id})),a.uniqBy(i,(function(n){var t,r;return null==(t=n.target)||null==(r=t.source)?void 0:r.id})).forEach((function(n,t){var r=n.target.source.id,e=o.findIndex((function(n){return n===r}))>=0;u.push(c(r,e,t))})),n.next=7,Promise.all(u);case 7:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),function(n){var t,r;return(null==(t=n.target)||null==(r=t.source)?void 0:r.type)===s.Unit}),f=function(n){return u(n)===i.Removal};e._RF.pop()}}}));

System.register("chunks:///_virtual/generic.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./index3.ts","./UnitManager.ts","./command.ts","./helper.ts","./layout.ts","./system.ts","./index.js","./fight.ts","./summon2.ts","./generic2.ts"],(function(e){"use strict";var t,n,r,a,o,i,s,u,c,l,d,f,m,g,x,p;return{setters:[function(e){t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){r=e.cclegacy,a=e.instantiate},null,null,function(e){o=e.UnitManager},function(e){i=e.GroundMoves,s=e.extractGroundMove},function(e){u=e.selectGroundGuide,c=e.selectGroundNode},function(e){l=e.getGroundExpos},function(e){d=e.system},function(e){f=e.default},function(e){m=e.animateRelocate},function(e){g=e.animateAirSummon},function(e){x=e.animateGroundRemoval,p=e.animateUnitRaise}],execute:function(){r._RF.push({},"019a6NdF05B0Jm60ofiRgr+","generic",void 0);var k=f.CommandSourceType,b=[k.InspiredSkill,k.PostFightSkill,k.PreFightSkill];e("playGeneric",function(){var e=t(n().mark((function e(t){var r,f,k,G,y,R,v,h,F,S,j,w,M,N,_,C,I;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.commands,f=0;case 2:if(!(f<r.length)){e.next=41;break}if(y=r[f],R=b.indexOf(null==(k=y.target)||null==(G=k.source)?void 0:G.type)>=0,v=s(y),!R){e.next=11;break}if(!(h=d.cardRefs[y.target.source.id])){e.next=11;break}return e.next=11,p(h);case 11:if(v!==i.Removal){e.next=18;break}if(!(F=d.cardRefs[y.target.from.id])){e.next=16;break}return e.next=16,x(F);case 16:e.next=38;break;case 18:if(v!==i.GenerateFromAir){e.next=29;break}return S=y.target.from.id,j=a(d.globalNodes.unitTemplate),w=l(u(y.target.to.owner)),j.getComponent(o).setCardId(S),j.parent=c(y.target.to.owner),d.cardRefs[S]=j,e.next=27,g(j,w[y.target.to.index]);case 27:e.next=38;break;case 29:if(v!==i.Relocate){e.next=38;break}if(!(M=d.cardRefs[y.target.from.id])){e.next=38;break}return N=y.target.to.owner,_=N===d.playerIds.me,C=_?d.globalNodes.playerGroundGuide:d.globalNodes.enemyGroundGuide,I=l(C),e.next=38,m(M,I[y.target.to.index]);case 38:f+=1,e.next=2;break;case 41:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());r._RF.pop()}}}));

System.register("chunks:///_virtual/generic2.ts",["cc","./resources.ts","./system.ts"],(function(e){"use strict";var n,t,o,i,s;return{setters:[function(e){n=e.cclegacy,t=e.tween,o=e.Vec3},function(e){i=e.playEffectSound},function(e){s=e.system}],execute:function(){n._RF.push({},"ccb58ZHxqRIY6gXkhzFPcrs","generic",void 0);e("animateGroundRemoval",(function(e){return new Promise((function(n){var c=e.getPosition(),a=1280*Math.random()-640;e.parent=s.globalNodes.playerHand,t(e).to(.5,{position:new o(a,c.y>0?600:-600,0),scale:new o(.6,.6,1)},{easing:"expoIn"}).call((function(){i("death",.5),e.destroy(),n()})).start()}))})),e("animateUnitRaise",(function(e){return new Promise((function(n){var i=e.getPosition().y>0?-20:20;t(e).by(.25,{position:new o(0,i,0)},{easing:"expoOut"}).delay(.5).call(n).by(.25,{position:new o(0,-i,0)},{easing:"expoOut"}).start()}))}));n._RF.pop()}}}));

System.register("chunks:///_virtual/handlers.ts",["cc","./index.mjs_cjs=&original=.js","./index2.ts","./index3.ts","./helper.ts","./system.ts","./util.ts","./index.js","./hud.ts","./preview.ts"],(function(e){"use strict";var n,t,r,i,s,a,o,c;return{setters:[function(e){n=e.cclegacy},null,function(e){t=e.replay},null,function(e){r=e.extractPlayerIds},function(e){i=e.system},function(e){s=e.mergeRemoteHistory},function(e){a=e.default},function(e){o=e.showEndGameRibbon},function(e){c=e.raiseHandCard}],execute:function(){n._RF.push({},"2337fLW1BhC44IP3JAljEJn","handlers",void 0);var u=a.selectHand,l=a.getInitialState,d=a.mergeFragmentToState;e("connect",(function(e,n){var a,o=e.jwt,c=e.context,u=e.duel;if(!i.winner&&n){var f=u.config,v=u.history,m=l(f);d(i.duel,m),i.serverState={jwt:o,context:c,config:f,history:[]},i.playerIds=r(f,c.userId),null==(a=i.globalNodes.board)||a.emit("stateReady"),s(v,0),setTimeout((function(){return t()}),200)}})),e("incomingBundles",(function(e){var n=e.level,r=e.bundles;i.winner||(s(r,n),t())})),e("gameOver",(function(e){var n=e.winner;if(!i.winner){var t=i.playerIds.me===n;i.winner=n,o(t)}})),e("cardHover",(function(e){for(var n=e.index,t=e.isMouseIn,r=u(i.duel,i.playerIds.enemy),s=0;s<r.length;s+=1){var a=i.cardRefs[r[s]];if(a)c(a,s===n&&t?60:0,.1,"back")}}));n._RF.pop()}}}));

System.register("chunks:///_virtual/helper.ts",["cc","./index.mjs_cjs=&original=.js","./CardManager.ts","./system.ts","./index.js"],(function(e){"use strict";var r,n,t,a,s,i,o;return{setters:[function(e){r=e.cclegacy,n=e.Vec2,t=e.Vec3,a=e.Color},null,function(e){s=e.CardManager},function(e){i=e.system},function(e){o=e.default}],execute:function(){r._RF.push({},"00337JfbyND4LuNGVh1dtqy","helper",void 0);var c=o.ElementalType,l=o.ClassType,u=o.selectHand,d=o.selectGround,m=(e("extractPlayerIds",(function(e,r){return r===e.firstPlayer.id?{me:e.firstPlayer.id,enemy:e.secondPlayer.id}:{me:e.secondPlayer.id,enemy:e.firstPlayer.id}})),e("cardIdFromNode",(function(e){var r;return null==(r=e.getComponent(s))?void 0:r.cardId})),e("delay",(function(e){return void 0===e&&(e=0),new Promise((function(r){setTimeout((function(){r()}),e)}))})),e("getVisualUri",(function(e){return"graphic/visuals/"+e.substring(0,5)+"/spriteFrame"})),e("getFoilUri",(function(e,r){switch(void 0===r&&(r=""),e.substring(7,9)){case c.Metal:return"graphic/cards/foil-metal"+r+"/spriteFrame";case c.Wood:return"graphic/cards/foil-wood"+r+"/spriteFrame";case c.Water:return"graphic/cards/foil-water"+r+"/spriteFrame";case c.Fire:return"graphic/cards/foil-fire"+r+"/spriteFrame";case c.Earth:return"graphic/cards/foil-earth"+r+"/spriteFrame";case c.Dark:return"graphic/cards/foil-dark"+r+"/spriteFrame";case c.Light:return"graphic/cards/foil-light"+r+"/spriteFrame";default:return"graphic/cards/foil-metal"+r+"/spriteFrame"}})),e("getClassUri",(function(e){switch(e){case l.Knight:return"graphic/cards/class-tank/spriteFrame";case l.Wizard:return"graphic/cards/class-wizard/spriteFrame";case l.Assassin:return"graphic/cards/class-assassin/spriteFrame";case l.Summoner:return"graphic/cards/class-summoner/spriteFrame";default:return"graphic/cards/class-tank/spriteFrame"}})),{black:"#000000",green:"#066922",blue:"#1055BC",red:"#AA1D21",magenta:"#6e13a4"}),g=(e("getSkillDesc",(function(e){return"<color=#222222>"+e.map((function(e){return e.style?"<color="+(m[e.style.color]||"#111111")+">"+e.text+"</color>":e.text})).join("")+"</color>"})),e("setCursor",(function(e){var r,n=null==(r=document)||null==r.getElementById?void 0:r.getElementById("GameCanvas");n&&(n.style.cursor=e)})),e("designScreenSize",new n(1280,720))),f=(e("extractMouseLocation",(function(e){var r=e.x,n=e.y;return new t(r-g.x/2,n-g.y/2,0)})),e("getGroundSize",(function(){var e;return null==(e=i.duel.setting)?void 0:e.groundSize})),e("selectDeckNode",(function(e){return i.playerIds.me===e?i.globalNodes.playerDeck:i.globalNodes.enemyDeck})),e("selectGroundNode",(function(e){return i.playerIds.me===e?i.globalNodes.playerGround:i.globalNodes.enemyGround})),e("selectGroundGuide",(function(e){return i.playerIds.me===e?i.globalNodes.playerGroundGuide:i.globalNodes.enemyGroundGuide})),e("selectHandNode",(function(e){return i.playerIds.me===e?i.globalNodes.playerHand:i.globalNodes.enemyHand})),e("selectHandGuide",(function(e){return i.playerIds.me===e?i.globalNodes.playerHandGuide:i.globalNodes.enemyHandGuide})),e("getHandSize",(function(e){var r;return null==(r=u(i.duel,e))?void 0:r.length}))),p=(e("getMyHandSize",(function(){return f(i.playerIds.me)})),e("getMyGround",(function(){return d(i.duel,i.playerIds.me)})),a.fromHEX(new a,"#1aab1a")),y=a.fromHEX(new a,"#FF0000");e("getPositiveColor",(function(e,r){return void 0===r&&(r=0),e>r?p:e<r?y:a.fromHEX(new a,"#FFFFFF")})),e("getInjectedCardId",(function(e,r){return r.indexOf("#")>=0?r:r+"#"+e.uniqueCardCount}));r._RF.pop()}}}));

System.register("chunks:///_virtual/hud.ts",["./rollupPluginModLoBabelHelpers.js","cc","./resources.ts","./system.ts"],(function(t){"use strict";var e,n,o,r,a,c,s,i,u,l,p;return{setters:[function(t){e=t.asyncToGenerator,n=t.regeneratorRuntime},function(t){o=t.cclegacy,r=t.UIOpacity,a=t.Label,c=t.tween,s=t.Vec3,i=t.Sprite},function(t){u=t.playEffectSound,l=t.playBackgroundSound},function(t){p=t.system}],execute:function(){o._RF.push({},"6659dvpcrhIXZgQcMTw+cdQ","hud",void 0);t("showTurnRibbon",function(){var t=e(n().mark((function t(e){var o,i;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=p.globalNodes.turnRibbon,i=o.getComponent(r),o.getChildByPath("message").getComponent(a).string=e,t.abrupt("return",new Promise((function(t){c(o).set({scale:new s(0,0,1),position:new s(0,25,0)}).call((function(){return u("your-turn4",.2)})).to(.5,{scale:new s(1,1,1)},{easing:"backOut"}).delay(1).call((function(){return u("your-turn3",.2)})).call((function(){c(i).to(.25,{opacity:0}).call((function(){o.setPosition(new s(9999,0,0)),i.opacity=255,t()})).start()})).to(.25,{scale:new s(0,0,1)},{easing:"backIn"}).start()})));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t("showEndGameRibbon",function(){var t=e(n().mark((function t(e){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=p.globalNodes.duelRibbon,o=e?"victory":"defeat";n.getChildByPath("ribbon").getComponent(i).grayscale=!e,n.getChildByPath("avatar/image").getComponent(i).grayscale=!e,n.getChildByPath("message").getComponent(a).string=e?"Victory!":"Defeat!",p.globalNodes.playerHand.parent=p.globalNodes.board.getChildByPath("Surface"),c(p.globalNodes.fog.getComponent(r)).to(2,{opacity:255}).start(),c(n).set({scale:new s(0,0,1),position:new s(0,-54,0)}).call((function(){l(o,.5,!1)})).to(.5,{scale:new s(1,1,1)},{easing:"backOut"}).call(t).start()})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());o._RF.pop()}}}));

System.register("chunks:///_virtual/index.ts",["cc","./system.ts","./types.ts","./handlers.ts","./util.ts","./sender.ts"],(function(n){"use strict";var e,o,t,r,s,d,a,c;return{setters:[function(n){e=n.cclegacy},function(n){o=n.system},function(n){t=n.DuelCommands},function(n){r=n.connect,s=n.incomingBundles,d=n.cardHover,a=n.gameOver},function(n){c=n.connectionInstance},function(e){var o={};o.internalSendCardHover=e.internalSendCardHover,o.sendBundles=e.sendBundles,o.sendCardHover=e.sendCardHover,o.sendCardSummon=e.sendCardSummon,o.sendCommand=e.sendCommand,o.sendConnect=e.sendConnect,o.sendEndTurn=e.sendEndTurn,n(o)}],execute:function(){e._RF.push({},"55f29Z1u1NOKo4u5GAKx9s4","index",void 0),c.onmessage=function(n){var e=JSON.parse(n.data),o=e.isMyCommand,c=e.command,i=e.payload;c===t.ConnectMatch?r(i,o):c===t.SendBundle?s(i):c===t.CardHover?o||d(i):c===t.GameOver&&a(i)},c.onerror=function(n){console.log(n)},c.onopen=function(){o.isSocketReady=!0};n("waitForSocket",(function(n){void 0===n&&(n=150);var e=0;return new Promise((function(t,r){var s=setInterval((function(){o.isSocketReady?(t(!0),clearInterval(s)):e>n&&(r("too many retries, socket may not be ready"),clearInterval(s)),e+=1}),200)}))}));e._RF.pop()}}}));

System.register("chunks:///_virtual/index2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./lodash.mjs_cjs=&original=.js","./index3.ts","./attribute.ts","./system.ts","./draw.ts","./fight2.ts","./generic.ts","./reinforce.ts","./summon.ts","./index.js","./lodash.js","./hud.ts"],(function(e){"use strict";var n,t,r,a,u,i,s,o,c,l,f,d,m,x;return{setters:[function(e){n=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){r=e.cclegacy},null,null,null,function(e){a=e.updatePlayers,u=e.updateGroundUnits},function(e){i=e.system},function(e){s=e.playDraw},function(e){o=e.playFight},function(e){c=e.playGeneric},function(e){l=e.playReinforce},function(e){f=e.playSummon},function(e){d=e.default},function(e){m=e.default},function(e){x=e.showTurnRibbon}],execute:function(){r._RF.push({},"6e530j/4xlJFa4molbmb3Pe","index",void 0);var p=!1,b=d.BundleGroup,h=d.mergeFragmentToState,y=d.runCommand,g=d.move,k=e("replay",function(){var e=n(t().mark((function e(){var n,r,d,m,h,y,g,j,w;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.history.length,r=i.historyLevel>=n,!(i.winner||p||r)){e.next=4;break}return e.abrupt("return");case 4:p=!0,d=i.historyLevel;case 6:if(!(d<n)){e.next=45;break}if(m=i.history[d],h=null==m?void 0:m.group,y=h===b.InitialDraw,g=h===b.TurnDraw,j=y||g,w=m.phaseOf===i.playerIds.me,v(m),i.winner||!g||!w){e.next=17;break}return e.next=17,x("Your Turn");case 17:if(!j){e.next=22;break}return e.next=20,s(m);case 20:e.next=39;break;case 22:if(b.Summon!==h){e.next=27;break}return e.next=25,f(m);case 25:e.next=39;break;case 27:if(b.FightCombat!==h){e.next=32;break}return e.next=30,o(m);case 30:e.next=39;break;case 32:if(b.Reinforce!==h){e.next=37;break}return e.next=35,l(m);case 35:e.next=39;break;case 37:return e.next=39,c(m);case 39:a(),u(),i.historyLevel+=1;case 42:d+=1,e.next=6;break;case 45:return p=!1,e.next=48,k();case 48:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),v=e("runCommandBundle",(function(e){e.commands.forEach((function(e){h(i.duel,y({duel:i.duel,command:e}))})),i.predict=g.fight(m.cloneDeep(i.duel)).duel}));r._RF.pop()}}}));

System.register("chunks:///_virtual/index3.ts",["cc","./card.ts","./common.ts","./fight.ts","./generic2.ts","./hud.ts","./preview.ts","./summon2.ts"],(function(a){"use strict";var e;return{setters:[function(a){e=a.cclegacy},function(e){var n={};n.animateDrawEnemyCard=e.animateDrawEnemyCard,n.animateDrawPlayerCard=e.animateDrawPlayerCard,n.animateExpoCard=e.animateExpoCard,n.animateGlowOff=e.animateGlowOff,n.animateGlowOn=e.animateGlowOn,n.animateGroundReveal=e.animateGroundReveal,a(n)},function(e){var n={};n.animateFade=e.animateFade,n.animateSkillReady=e.animateSkillReady,n.animateSwapLabel=e.animateSwapLabel,n.shakeGround=e.shakeGround,n.simpleMove=e.simpleMove,a(n)},function(e){var n={};n.animateCardAttack=e.animateCardAttack,n.animateRelocate=e.animateRelocate,a(n)},function(e){var n={};n.animateGroundRemoval=e.animateGroundRemoval,n.animateUnitRaise=e.animateUnitRaise,a(n)},function(e){var n={};n.showEndGameRibbon=e.showEndGameRibbon,n.showTurnRibbon=e.showTurnRibbon,a(n)},function(e){var n={};n.raiseHandCard=e.raiseHandCard,n.raiseHandPreview=e.raiseHandPreview,n.raiseUnitPreview=e.raiseUnitPreview,a(n)},function(e){var n={};n.animateAirSummon=e.animateAirSummon,n.animateEnemySummon=e.animateEnemySummon,n.animateGroundAppear=e.animateGroundAppear,n.animatePlayerSummon=e.animatePlayerSummon,a(n)}],execute:function(){e._RF.push({},"e4102wyJT5Gkb2YFGpWKVbm","index",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/layout.ts",["cc","./helper.ts","./system.ts"],(function(t){"use strict";var e,o,n,r;return{setters:[function(t){e=t.cclegacy,o=t.Vec3},function(t){n=t.getGroundSize},function(t){r=t.system}],execute:function(){e._RF.push({},"82986irFHtFQolYndO2sDqd","layout",void 0);var u=t("getPositionExpos",(function(t,e,n,u){void 0===t&&(t=r.globalNodes.centerExpo),void 0===n&&(n=220);for(var s=[],c=t.getPosition(),g=n*e/2,f=n/2,l=i(e,n,u),p=0;p<e;p+=1){var a=p*n-g+f;s.push(new o(c.x+a+l,c.y,0))}return s})),i=function(t,e,o){return o?"left"===o?t*e/2:"right"===o?t*e/-2:void 0:0};t("getCenterExpos",(function(t){return u(r.globalNodes.centerExpo,t,210)})),t("getLeftExpos",(function(t){return u(r.globalNodes.leftExpo,t,210,"left")})),t("getRightExpos",(function(t){return u(r.globalNodes.rightExpo,t,210,"right")})),t("getHandExpos",(function(t,e){return u(t,e,80)})),t("getGroundExpos",(function(t){return u(t,n(),100)}));e._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.ts"],(function(r){"use strict";var e,n,t,a,o,i,s,c,u,p,l,g;return{setters:[function(r){e=r.applyDecoratedDescriptor,n=r.inheritsLoose,t=r.initializerDefineProperty,a=r.assertThisInitialized,o=r.asyncToGenerator,i=r.regeneratorRuntime},function(r){s=r.cclegacy,c=r._decorator,u=r.ProgressBar,p=r.director,l=r.Component},function(r){g=r.waitForSocket}],execute:function(){var f,d,y,h,v;s._RF.push({},"a6f1fi8DXBCuZtULvrumynH","LoadingManager",void 0);var L=c.ccclass,m=c.property;r("LoadingManager",(f=L("LoadingManager"),d=m(u),f((v=e((h=function(r){function e(){for(var e,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return e=r.call.apply(r,[this].concat(o))||this,t(e,"progressBar",v,a(e)),e}return n(e,r),e.prototype.start=function(){var r=this;p.preloadScene("Duel",(function(e,n){r.progressBar.progress=e/(n+2)}),o(i().mark((function r(){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,g();case 2:p.loadScene("Duel");case 3:case"end":return r.stop()}}),r)}))))},e}(l)).prototype,"progressBar",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=h))||y));s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BoardManager.ts","./CardManager.ts","./DuelManager.ts","./DuelRibbonController.ts","./LoadingManager.ts","./PreviewManager.ts","./TurnController.ts","./UnitManager.ts","./handlers.ts","./index.ts","./sender.ts","./util.ts","./draw.ts","./fight2.ts","./generic.ts","./index2.ts","./reinforce.ts","./summon.ts","./card.ts","./common.ts","./fight.ts","./generic2.ts","./hud.ts","./index3.ts","./preview.ts","./summon2.ts","./animation.ts","./attribute.ts","./command.ts","./helper.ts","./layout.ts","./resources.ts","./system.ts","./types.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/preview.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){"use strict";var t,e,r,i,o;return{setters:[function(n){t=n.asyncToGenerator,e=n.regeneratorRuntime},function(n){r=n.cclegacy,i=n.tween,o=n.Vec3}],execute:function(){r._RF.push({},"d7949a2yi5PeJFE3pf3grSb","preview",void 0);n("raiseUnitPreview",function(){var n=t(e().mark((function n(t,r){var u,a,s;return e().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u=r.getPosition(),a=u.x>0?-170:170,u.y,s=26,n.abrupt("return",new Promise((function(n){t.setPosition(u.x+a,u.y+s),i(t.getChildByPath("Card")).set({position:new o(0,-15,0),scale:new o(.6,.6,1)}).to(.15,{position:new o(0,0,0)},{easing:"backOut"}).call((function(){return n()})).start()})));case 4:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),n("raiseHandPreview",function(){var n=t(e().mark((function n(t,r,u){return e().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r=-12),void 0===u&&(u=.15),n.abrupt("return",new Promise((function(n){i(t.getChildByPath("Card")).set({position:new o(0,r,0)}).to(u,{position:new o(0,0,0)},{easing:"backOut"}).call((function(){return n()})).start()})));case 3:case"end":return n.stop()}}),n)})));return function(t,e,r){return n.apply(this,arguments)}}()),n("raiseHandCard",function(){var n=t(e().mark((function n(t,r,u,a){return e().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r=100),void 0===u&&(u=.1),void 0===a&&(a="front"),n.abrupt("return",new Promise((function(n){i(t.getChildByPath(a)).to(u,{position:new o(0,r,0)},{easing:"cubicInOut"}).call((function(){return n()})).start()})));case 4:case"end":return n.stop()}}),n)})));return function(t,e,r,i){return n.apply(this,arguments)}}());r._RF.pop()}}}));

System.register("chunks:///_virtual/PreviewManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./helper.ts","./system.ts","./index3.ts","./index.js","./preview.ts"],(function(e){"use strict";var n,t,i,o,s,r,a,d,c,u,h;return{setters:[function(e){n=e.inheritsLoose},function(e){t=e.cclegacy,i=e._decorator,o=e.Node,s=e.Vec2,r=e.Component},null,function(e){a=e.setCursor,d=e.cardIdFromNode},function(e){c=e.system},null,function(e){u=e.default},function(e){h=e.raiseHandCard}],execute:function(){var p;t._RF.push({},"372f97ULWxO7rz1m5SZQgwe","PreviewManager",void 0);var g=i.ccclass,f=o.EventType,l=u.selectPlayer,v=u.getCard,M=u.CardType;e("PreviewManager",g("PreviewManager")(p=function(e){function t(){for(var n,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(n=e.call.apply(e,[this].concat(i))||this).props={},n}n(t,e);var i=t.prototype;return i.start=function(){this.props.card=this.node.getChildByPath("Card"),this.node.on(f.MOUSE_ENTER,this.onMouseEnter.bind(this)),this.node.on(f.MOUSE_LEAVE,this.onMouseLeave.bind(this)),this.node.on(f.MOUSE_DOWN,this.onMouseDown.bind(this)),this.node.on(f.MOUSE_UP,this.onMouseUp.bind(this)),this.node.on(f.MOUSE_MOVE,this.onMouseMove.bind(this))},i.onMouseEnter=function(){this.props.dragging=!1,a("grab")},i.onMouseLeave=function(){a("auto"),this.hidePreview()},i.onMouseDown=function(e){this.props.dragging=!0,this.props.dragOffset=e.getLocation()},i.onMouseUp=function(){this.props.dragging=!1},i.onMouseMove=function(e){if(this.props.dragging&&c.isCommandAble){var n=e.getLocation();if(s.distance(n,this.props.dragOffset)>5){var t=d(c.activeCard),i=v(c.duel.cardMap,t),o=l(c.duel,c.playerIds.me);if(i.kind===M.Hero&&o.perTurnHero<=0)return;this.hidePreview(),c.dragging=!0}}},i.hidePreview=function(){(this.node.setPosition(190,740),c.activeCard)&&(h(c.activeCard,0,.02),c.activeCard.getComponent("cc.UIOpacity").opacity=255)},t}(r))||p);t._RF.pop()}}}));

System.register("chunks:///_virtual/reinforce.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./index3.ts","./layout.ts","./system.ts","./index.js","./fight.ts"],(function(e){"use strict";var n,r,t,o,u,i,a;return{setters:[function(e){n=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){t=e.cclegacy},null,null,function(e){o=e.getGroundExpos},function(e){u=e.system},function(e){i=e.default},function(e){a=e.animateRelocate}],execute:function(){t._RF.push({},"d943d7BAUFFSJS5+5iaSflx","reinforce",void 0);var s=i.DuelCommandType;e("playReinforce",function(){var e=n(r().mark((function e(n){var t,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.commands,i=[],t.filter((function(e){return e.type===s.CardMove})).filter((function(e){return e.type===s.CardMove})).forEach((function(e){var n,r=e.owner,t=e.target,s=u.cardRefs[null==t||null==(n=t.from)?void 0:n.id];if(s){var c=u.playerIds.me===r?u.globalNodes.playerGroundGuide:u.globalNodes.enemyGroundGuide,l=o(c);i.push(a(s,l[t.to.index]))}})),e.next=6,Promise.all(i);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());t._RF.pop()}}}));

System.register("chunks:///_virtual/resources.ts",["./rollupPluginModLoBabelHelpers.js","cc","./helper.ts","./system.ts"],(function(e){"use strict";var n,r,t,u,o,c,a,s;return{setters:[function(e){n=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){t=e.cclegacy,u=e.sys,o=e.resources,c=e.instantiate},function(e){a=e.delay},function(e){s=e.system}],execute:function(){t._RF.push({},"f5ebe4LOQlJEp1F2zBF5UCO","resources",void 0);var i,f,p,d={},v=u.isBrowser;v&&(i=new AudioContext,(p=i.createGain()).connect(i.destination),document.addEventListener("click",(function(){"running"!==i.state&&i.resume()})));var l=function(){var e=n(r().mark((function e(){var n,t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=v?p.gain.value:s.audioSource.volume,t=n;case 2:if(!(t>0)){e.next=9;break}return v?p.gain.value=t:s.audioSource.volume=t,e.next=6,a(100);case 6:t-=.01,e.next=2;break;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=n(r().mark((function e(n){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===n&&(n=1),t=0;case 2:if(!(t<n)){e.next=9;break}return v?p.gain.value=t:s.audioSource.volume=t,e.next=6,a(50);case 6:t+=.01,e.next=2;break;case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),w=e("playBackgroundSound",function(){var e=n(r().mark((function e(n,t,u){var o,c,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=1),void 0===u&&(u=!0),e.next=4,y(n);case 4:return o=e.sent,c=o.clip,a=o.buffer,v?(f&&(f.stop(),f.buffer=null,f.disconnect()),(f=i.createBufferSource()).buffer=a,f.connect(p),f.loop=u,f.start(0)):(s.audioSource.stop(),s.audioSource.clip=c,s.audioSource.play()),e.next=10,x(t);case 10:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}()),m=(e("switchBackgroundSound",function(){var e=n(r().mark((function e(n,t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=1),e.next=3,l();case 3:w(n,t);case 4:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}()),e("playEffectSound",function(){var e=n(r().mark((function e(n,t){var u,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=1),e.next=3,y(n);case 3:u=e.sent,o=u.clip,s.audioSource.playOneShot(o,t);case 6:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}()),e("instantiatePrefab",(function(e){return new Promise((function(n,r){o.load(e,(function(e,t){e?r(e):n(c(t))}))}))})),e("bufferFromAsset",function(){var e=n(r().mark((function e(n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var t=new XMLHttpRequest;t.open("GET",n.nativeUrl,!0),t.responseType="arraybuffer",t.onload=function(){return e(t.response)},t.onerror=function(){return r()},t.send()})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())),h=e("extractAudioBuffer",function(){var e=n(r().mark((function e(n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){i.decodeAudioData(n,(function(n){return e(n)}),(function(e){return r(e)}))})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),y=e("getAudioSource",function(){var e=n(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,u){var c=d[t];c?e(c):o.load("sound/"+t,n(r().mark((function n(o,c){var a;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!o){n.next=4;break}u(o),n.next=13;break;case 4:if(d[t]={clip:c},!v){n.next=12;break}return n.next=8,m(c);case 8:return a=n.sent,n.next=11,h(a);case 11:d[t].buffer=n.sent;case 12:e(d[t]);case 13:case"end":return n.stop()}}),n)}))))})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());t._RF.pop()}}}));

System.register("chunks:///_virtual/sender.ts",["cc","./index.mjs_cjs=&original=.js","./lodash.mjs_cjs=&original=.js","./index2.ts","./system.ts","./types.ts","./util.ts","./index.js","./lodash.js"],(function(n){"use strict";var e,t,o,d,a,s,c;return{setters:[function(n){e=n.cclegacy},null,null,function(n){t=n.replay},function(n){o=n.system},function(n){d=n.DuelCommands},function(n){a=n.connectionInstance},function(n){s=n.default},function(n){c=n.default}],execute:function(){e._RF.push({},"93bad7fcINC6JyHdkGajEE7","sender",void 0);var r=s.getCardState,u=s.selectHand,i=s.move,l=s.DuelPlace,m=n("sendCommand",(function(n,e){var t={jwt:o.jwt,client:"cardGame",command:n};t&&(t.payload=e),a.send(JSON.stringify(t))})),f=(n("sendConnect",(function(){var n,e=new URLSearchParams(location.search).get("jwt"),t=null==(n=localStorage)?void 0:n.getItem("murgJwt");o.jwt=e||t,m(d.ConnectMatch)})),n("sendBundles",(function(n){m(d.SendBundle,n),n.forEach((function(n){o.history.push(n)})),t()}))),j=(n("sendCardSummon",(function(n,e){var t=r(o.duel.stateMap,n),d=i.summonCard(c.cloneDeep(o.duel),{from:{owner:t.owner,id:t.id,place:l.Hand},to:{owner:t.owner,index:e,place:l.Ground}}).commandBundles;f(d)})),n("sendEndTurn",(function(){f(i.endTurn(o.duel).commandBundles)})),n("internalSendCardHover",(function(n,e){var t=r(o.duel.stateMap,n),a=u(o.duel,t.owner).indexOf(n);m(d.CardHover,{index:a,isMouseIn:e})})));n("sendCardHover",c.throttle(j,200));e._RF.pop()}}}));

System.register("chunks:///_virtual/summon.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./index3.ts","./UnitManager.ts","./helper.ts","./layout.ts","./system.ts","./index.js","./card.ts","./summon2.ts"],(function(e){"use strict";var n,t,r,a,o,s,u,i,c,l,m,d;return{setters:[function(e){n=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){r=e.cclegacy,a=e.instantiate},null,null,function(e){o=e.UnitManager},function(e){s=e.selectGroundGuide},function(e){u=e.getGroundExpos},function(e){i=e.system},function(e){c=e.default},function(e){l=e.animateGlowOff},function(e){m=e.animatePlayerSummon,d=e.animateEnemySummon}],execute:function(){r._RF.push({},"26489EsRcJABLUB6igMkDxe","summon",void 0);var f=c.DuelCommandType;e("playSummon",function(){var e=n(t().mark((function e(n){var r,c,p,g;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.commands,c=[],p=t().mark((function e(){var n,p,y,h,v,x,b,k,G,w;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r[g],p=n.type,y=n.owner,h=n.target,p===f.CardMove&&(v=h.from.id,x=y===i.playerIds.me,b=u(s(y)),k=b[h.to.index],G=i.cardRefs[v],(w=a(i.globalNodes.unitTemplate)).getComponent(o).setCardId(v),i.cardRefs[v]=w,x?(w.parent=i.globalNodes.playerGround,l(G),c.push(m(G,w,k))):(w.parent=i.globalNodes.enemyGround,w.getChildByPath("front").active=!1,w.getChildByPath("back").active=!0,c.push(d(G,w,k)),setTimeout((function(){return G.destroy()}),0)));case 3:case"end":return e.stop()}}),e)})),g=0;case 4:if(!(g<r.length)){e.next=9;break}return e.delegateYield(p(),"t0",6);case 6:g+=1,e.next=4;break;case 9:return e.next=11,Promise.all(c);case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());r._RF.pop()}}}));

System.register("chunks:///_virtual/summon2.ts",["cc","./resources.ts","./common.ts"],(function(n){"use strict";var t,e,o,i,s,u;return{setters:[function(n){t=n.cclegacy,e=n.Vec3,o=n.tween,i=n.Quat},function(n){s=n.playEffectSound},function(n){u=n.shakeGround}],execute:function(){t._RF.push({},"8404fadAkxLCKcq4P5/7/V6","summon",void 0);n("animatePlayerSummon",(function(n,t,i){return new Promise((function(r){var a=n.getPosition().x>i.x?10:-10,c=new e(i.x+a,i.y+200,i.z);o(n).to(.1,{scale:new e(.52,.52,1)},{easing:"backOut"}).call((function(){return s("light-fire",.5)})).to(.4,{scale:new e(.23,.23,1),position:c},{easing:"expoOut"}).call((function(){n.destroy(),o(t).set({position:c,scale:new e(.25,.25,1)}).to(.3,{position:i,scale:new e(.24,.24,1)},{easing:"expoOut"}).call((function(){s("ground-hit"),u(),r()})).start()})).start()}))})),n("animateEnemySummon",(function(n,t,r){return new Promise((function(a){var c=n.getPosition(),l=new e(r.x,r.y+200,r.z),f=i.fromEuler(new i,180,0,0),m=i.fromEuler(new i,0,0,0);o(t).set({position:c,rotation:f}).to(.1,{scale:new e(.5,.5,1)},{easing:"backOut"}).call((function(){return s("light-fire",.5)})).to(.4,{position:l,scale:new e(.23,.23,1),rotation:m},{easing:"expoOut"}).to(.3,{position:r},{easing:"expoOut"}).call((function(){s("ground-hit"),u(),a()})).start()}))})),n("animateGroundAppear",(function(n,t){return new Promise((function(i){o(n).set({scale:new e(.25,.25,1),position:t}).to(.5,{scale:new e(.24,.24,1)}).call((function(){return i()})).start()}))})),n("animateAirSummon",(function(n,t){return new Promise((function(i){var r=1280*Math.random()-640;o(n).set({position:new e(r,t.y>0?600:-600,1)}).to(1,{position:t},{easing:"expoOut"}).call((function(){s("ground-hit"),u(),i()})).start()}))}));t._RF.pop()}}}));

System.register("chunks:///_virtual/system.ts",["cc","./index.mjs_cjs=&original=.js","./lodash.mjs_cjs=&original=.js","./index.js","./lodash.js"],(function(e){"use strict";var r,t,n;return{setters:[function(e){r=e.cclegacy},null,null,function(e){t=e.default},function(e){n=e.default}],execute:function(){r._RF.push({},"fdf188UsFlB+67e6cyojjyQ","system",void 0);var s=t.defaultSetting,a=t.DuelPhases,u=t.nanoId,i=e("makeDuelProxy",(function(e){var r={};return e.getSubscriptionCount=function(){return Object.keys(r).reduce((function(e,t){return e+Object.keys(r[t]).length}),0)},e.subscribe=function(t,n,s){var a,i=u();r[t]?r[t][i]=n:r[t]=((a={})[i]=n,a);return s&&(t.startsWith("state#")?n(e.stateMap[t.substring(6)]):n(e[t])),function(){delete r[t][i]}},e.stateMap=new Proxy(e.stateMap,{set:function(e,t,s){if(n.isEqual(e[t],s))return!0;var a=r["state#"+t];return a&&Object.keys(a).forEach((function(r){var n;null==(n=a[r])||n.call(a,s,e[t])})),e[t]=s,!0}}),new Proxy(e,{set:function(e,t,s){if(n.isEqual(e[t],s))return!0;var a=r[t];return a&&Object.keys(a).forEach((function(r){var n;null==(n=a[r])||n.call(a,s,e[t])})),e[t]=s,!0}})})),o={id:"default",health:s.initialPlayerHealth,attack:0,defense:0,perTurnHero:s.perTurnHero,perTurnTroop:s.perTurnTroop,perTurnDraw:s.perTurnDraw,perTurnSpell:s.perTurnSpell},c={cardMap:{},stateMap:{},turn:0,phase:a.Draw,phaseOf:"",uniqueCardCount:0,setting:s,firstMover:"",firstPlayer:o,secondPlayer:o,firstDeck:[],secondDeck:[],firstHand:[],secondHand:[],firstGround:[],secondGround:[],firstGrave:[],secondGrave:[]},l=e("system",{playerIds:{me:"",enemy:""},duel:i(c),predict:c,isSocketReady:!1,serverState:{},isCommandAble:!1,cardRefs:{},globalNodes:{},history:[],historyLevel:0,previewing:!1,dragging:!1});globalThis.system=l,r._RF.pop()}}}));

System.register("chunks:///_virtual/TurnController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./helper.ts","./resources.ts","./system.ts","./index.ts","./index3.ts","./index.js","./common.ts","./sender.ts"],(function(e){"use strict";var n,t,r,s,o,i,u,a,l,h,c,d,f,p;return{setters:[function(e){n=e.inheritsLoose},function(e){t=e.cclegacy,r=e._decorator,s=e.Node,o=e.Button,i=e.Color,u=e.Component},null,function(e){a=e.setCursor},function(e){l=e.playEffectSound},function(e){h=e.system},null,null,function(e){c=e.default},function(e){d=e.animateFade,f=e.animateSwapLabel},function(e){p=e.sendEndTurn}],execute:function(){var b;t._RF.push({},"21ee291zRZEKbq4wP1p9CeZ","TurnController",void 0);var y=r.ccclass,m=c.DuelPhases,v=s.EventType,C=o.EventType;e("TurnController",y("TurnController")(b=function(e){function t(){for(var n,t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(n=e.call.apply(e,[this].concat(r))||this).unSubscribers=[],n.playerTurnGlow=void 0,n.enemyTurnGlow=void 0,n.turnLabel=void 0,n.orb=void 0,n}n(t,e);var r=t.prototype;return r.start=function(){var e=this;this.playerTurnGlow=this.node.getChildByPath("Orb/Player Glow"),this.enemyTurnGlow=this.node.getChildByPath("Orb/Enemy Glow"),this.turnLabel=this.node.getChildByPath("Orb/Button/Label"),this.orb=this.node.getChildByPath("Orb"),this.orb.on(v.MOUSE_ENTER,this.onMouseEnter.bind(this)),this.orb.on(v.MOUSE_LEAVE,this.onMouseLeave.bind(this)),this.orb.on(C.CLICK,this.onButtonClick.bind(this)),this.unSubscribers.push(h.duel.subscribe("phase",(function(n){return e.onPhaseChange(n,h.duel.phaseOf)}))),this.unSubscribers.push(h.duel.subscribe("phaseOf",(function(n){return e.onPhaseChange(h.duel.phase,n)})))},r.onDestroy=function(){this.unSubscribers.forEach((function(e){return e()}))},r.onPhaseChange=function(e,n){var t=e===m.Setup,r=n===h.playerIds.me,s=this.orb.getComponent(o),u=i.fromHEX(new i,r?"#4da7ea":"#ee5846"),a=i.fromHEX(new i,"#ffffff");if(t?(s.interactable=!0,d(this.playerTurnGlow,r?255:0),d(this.enemyTurnGlow,r?0:255)):(s.interactable=!1,d(this.playerTurnGlow,0),d(this.enemyTurnGlow,0)),e===m.Draw){var l=0===h.duel.turn?"distribute":"draw";f(this.turnLabel,l,u)}else if(e===m.Setup){var c=r?"end turn":"enemy turn";f(this.turnLabel,c,u)}else e===m.PreFight?f(this.turnLabel,"pre fight",a):e===m.Fight?f(this.turnLabel,"fight",a):e===m.PostFight&&f(this.turnLabel,"post fight",a)},r.onMouseEnter=function(){var e=h.duel.phase===m.Setup,n=h.duel.phaseOf===h.playerIds.me;e&&n&&a("pointer")},r.onMouseLeave=function(){a("auto")},r.onButtonClick=function(){var e=h.duel.phase===m.Setup,n=h.duel.phaseOf===h.playerIds.me;!h.winner&&e&&n&&(l("end-turn"),p())},t}(u))||b);t._RF.pop()}}}));

System.register("chunks:///_virtual/types.ts",["cc"],(function(e){"use strict";var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){var t;e("DuelCommands",void 0),n._RF.push({},"b9849Q5wzxDcrqWw9j/6mLS","types",void 0),function(e){e.ConnectMatch="ConnectMatch",e.SendBundle="SendBundle",e.CardHover="CardHover",e.GameOver="GameOver"}(t||(t=e("DuelCommands",{}))),n._RF.pop()}}}));

System.register("chunks:///_virtual/UnitManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./attribute.ts","./helper.ts","./resources.ts","./system.ts","./CardManager.ts","./index3.ts","./index.js","./preview.ts"],(function(t){"use strict";var e,i,a,n,r,o,d,s,c,l,h,u,g,f,v,p,C;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,a=t._decorator,n=t.Node,r=t.UIOpacity,o=t.Sprite,d=t.resources,s=t.Component},null,function(t){c=t.updateUnit},function(t){l=t.getVisualUri,h=t.getFoilUri,u=t.setCursor},function(t){g=t.playEffectSound},function(t){f=t.system},function(t){v=t.CardManager},null,function(t){p=t.default},function(t){C=t.raiseUnitPreview}],execute:function(){var y;i._RF.push({},"679f760eihMgrm4ElJYfqwd","UnitManager",void 0);var M=a.ccclass,P=p.getCard,b=p.getCardState,m=p.ActivationType,E=n.EventType;t("UnitManager",M("UnitManager")(y=function(t){function i(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).unsubscribe=void 0,e.cardId=void 0,e.uiOpacity=void 0,e.cardFoil=void 0,e.cardVisual=void 0,e.cardAttack=void 0,e.cardDefense=void 0,e.cardHealth=void 0,e}e(i,t);var a=i.prototype;return a.start=function(){this.uiOpacity=this.node.getComponent(r),this.cardFoil=this.node.getChildByPath("front/foil").getComponent(o),this.cardVisual=this.node.getChildByPath("front/visual").getComponent(o),this.cardAttack=this.node.getChildByPath("front/attack"),this.cardDefense=this.node.getChildByPath("front/defense"),this.cardHealth=this.node.getChildByPath("front/health"),this.cardId&&this.renderCard(b(f.duel.stateMap,this.cardId)),this.node.on(E.MOUSE_ENTER,this.onMouseEnter.bind(this)),this.node.on(E.MOUSE_LEAVE,this.onMouseLeave.bind(this))},a.setCardId=function(t){t!==this.cardId&&(this.cardId=t)},a.renderCard=function(t){var e,i=this;if(this.cardFoil){var a=P(f.duel.cardMap,t.id),n=l(a.id),r=h(a.id,"-ground");d.load(n,(function(t,e){t||(i.cardVisual.spriteFrame=e)})),d.load(r,(function(t,e){t||(i.cardFoil.spriteFrame=e)})),(null==(e=a.skill)?void 0:e.activation)===m.Charge&&(this.node.getChildByPath("front/charge").active=!0),c(t.id)}},a.onMouseEnter=function(){var t;if(u("pointer"),!f.winner&&!f.dragging&&this.cardId&&(null==(t=this.node.getChildByPath("back"))||!t.active)){var e=f.globalNodes.cardPreview.getChildByPath("Card");f.globalNodes.cardPreview.getChildByPath("Card/glow").active=!1,g("card-raise",.2),C(f.globalNodes.cardPreview,this.node),e.getComponent(v).setCardId(this.cardId.substring(0,9))}},a.onMouseLeave=function(){u("auto"),f.globalNodes.cardPreview.setPosition(190,740)},i}(s))||y);i._RF.pop()}}}));

System.register("chunks:///_virtual/util.ts",["cc","./system.ts"],(function(t){"use strict";var e,c;return{setters:[function(t){e=t.cclegacy},function(t){c=t.system}],execute:function(){e._RF.push({},"19fb5JQSsNBy4XoMBj4Ih13","util",void 0);t("connectionInstance",new WebSocket("wss://94zbw8sdk9.execute-api.ap-northeast-1.amazonaws.com/prod/")),t("mergeRemoteHistory",(function(t,e){return c.history.length<e?{conflict:!0}:(c.history=c.history.slice(0,e).concat(t),{conflict:!1})}));e._RF.pop()}}}));
